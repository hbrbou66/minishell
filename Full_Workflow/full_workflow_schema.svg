<?xml version="1.0" encoding="UTF-8"?>
<svg width="1600" height="1200" xmlns="http://www.w3.org/2000/svg">
  <!-- Background -->
  <rect width="1600" height="1200" fill="#f8f9fa" stroke="#dee2e6" stroke-width="2"/>
  
  <!-- Title -->
  <text x="800" y="30" text-anchor="middle" font-family="Arial, sans-serif" font-size="24" font-weight="bold" fill="#212529">Minishell Complete Program Flow</text>
  
  <!-- Arrow marker definitions -->
  <defs>
    <marker id="arrowhead" markerWidth="10" markerHeight="7" refX="10" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#007bff"/>
    </marker>
    <marker id="errorarrow" markerWidth="10" markerHeight="7" refX="10" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#dc3545"/>
    </marker>
    <marker id="dataarrow" markerWidth="10" markerHeight="7" refX="10" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#28a745"/>
    </marker>
    <marker id="returnarrow" markerWidth="10" markerHeight="7" refX="10" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#ffc107"/>
    </marker>
  </defs>

  <!-- PHASE 1: INITIALIZATION -->
  <g id="initialization-phase">
    <rect x="50" y="60" width="350" height="180" fill="none" stroke="#007bff" stroke-width="3" rx="10"/>
    <text x="225" y="80" text-anchor="middle" font-family="Arial, sans-serif" font-size="16" font-weight="bold" fill="#007bff">INITIALIZATION PHASE</text>
    
    <!-- main() -->
    <rect x="70" y="100" width="100" height="40" fill="#007bff" stroke="#0056b3" stroke-width="2" rx="5"/>
    <text x="120" y="125" text-anchor="middle" font-family="Arial, sans-serif" font-size="12" font-weight="bold" fill="white">main()</text>
    
    <!-- check_argc() -->
    <rect x="190" y="100" width="100" height="40" fill="#28a745" stroke="#1e7e34" stroke-width="2" rx="5"/>
    <text x="240" y="125" text-anchor="middle" font-family="Arial, sans-serif" font-size="11" font-weight="bold" fill="white">check_argc()</text>
    
    <!-- init_shell() -->
    <rect x="310" y="100" width="80" height="40" fill="#28a745" stroke="#1e7e34" stroke-width="2" rx="5"/>
    <text x="350" y="125" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" font-weight="bold" fill="white">init_shell()</text>
    
    <!-- Environment Setup -->
    <rect x="70" y="160" width="120" height="40" fill="#6c757d" stroke="#495057" stroke-width="2" rx="5"/>
    <text x="130" y="180" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" font-weight="bold" fill="white">init_env()</text>
    <text x="130" y="192" text-anchor="middle" font-family="Arial, sans-serif" font-size="9" fill="white">Environment</text>
    
    <!-- Memory System -->
    <rect x="210" y="160" width="120" height="40" fill="#6c757d" stroke="#495057" stroke-width="2" rx="5"/>
    <text x="270" y="180" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" font-weight="bold" fill="white">ft_malloc()</text>
    <text x="270" y="192" text-anchor="middle" font-family="Arial, sans-serif" font-size="9" fill="white">Memory System</text>
  </g>

  <!-- PHASE 2: INPUT HANDLING -->
  <g id="input-phase">
    <rect x="450" y="60" width="300" height="180" fill="none" stroke="#fd7e14" stroke-width="3" rx="10"/>
    <text x="600" y="80" text-anchor="middle" font-family="Arial, sans-serif" font-size="16" font-weight="bold" fill="#fd7e14">INPUT HANDLING PHASE</text>
    
    <!-- Signal Setup -->
    <rect x="470" y="100" width="90" height="40" fill="#dc3545" stroke="#c82333" stroke-width="2" rx="5"/>
    <text x="515" y="120" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" font-weight="bold" fill="white">define_sig()</text>
    <text x="515" y="132" text-anchor="middle" font-family="Arial, sans-serif" font-size="9" fill="white">SIGINT/QUIT</text>
    
    <!-- Input State -->
    <rect x="580" y="100" width="80" height="40" fill="#fd7e14" stroke="#e8590c" stroke-width="2" rx="5"/>
    <text x="620" y="115" text-anchor="middle" font-family="Arial, sans-serif" font-size="9" font-weight="bold" fill="white">recevied_from_</text>
    <text x="620" y="127" text-anchor="middle" font-family="Arial, sans-serif" font-size="9" font-weight="bold" fill="white">input()</text>
    
    <!-- Readline -->
    <rect x="680" y="100" width="60" height="40" fill="#17a2b8" stroke="#138496" stroke-width="2" rx="5"/>
    <text x="710" y="120" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" font-weight="bold" fill="white">readline()</text>
    
    <!-- History -->
    <rect x="470" y="160" width="90" height="40" fill="#6f42c1" stroke="#59359a" stroke-width="2" rx="5"/>
    <text x="515" y="180" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" font-weight="bold" fill="white">add_history()</text>
    
    <!-- Exit Status -->
    <rect x="580" y="160" width="80" height="40" fill="#6c757d" stroke="#495057" stroke-width="2" rx="5"/>
    <text x="620" y="180" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" font-weight="bold" fill="white">e_status()</text>
    
    <!-- Cleanup -->
    <rect x="680" y="160" width="60" height="40" fill="#6c757d" stroke="#495057" stroke-width="2" rx="5"/>
    <text x="710" y="175" text-anchor="middle" font-family="Arial, sans-serif" font-size="9" font-weight="bold" fill="white">rl_clear_</text>
    <text x="710" y="187" text-anchor="middle" font-family="Arial, sans-serif" font-size="9" font-weight="bold" fill="white">history()</text>
  </g>

  <!-- PHASE 3: PARSING -->
  <g id="parsing-phase">
    <rect x="50" y="280" width="700" height="220" fill="none" stroke="#20c997" stroke-width="3" rx="10"/>
    <text x="400" y="300" text-anchor="middle" font-family="Arial, sans-serif" font-size="16" font-weight="bold" fill="#20c997">PARSING PHASE</text>
    
    <!-- Syntax Validation -->
    <rect x="70" y="320" width="120" height="40" fill="#20c997" stroke="#17a085" stroke-width="2" rx="5"/>
    <text x="130" y="340" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" font-weight="bold" fill="white">ft_parse_command()</text>
    <text x="130" y="352" text-anchor="middle" font-family="Arial, sans-serif" font-size="9" fill="white">Syntax Check</text>
    
    <!-- Tokenization -->
    <rect x="210" y="320" width="100" height="40" fill="#20c997" stroke="#17a085" stroke-width="2" rx="5"/>
    <text x="260" y="340" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" font-weight="bold" fill="white">ft_split()</text>
    <text x="260" y="352" text-anchor="middle" font-family="Arial, sans-serif" font-size="9" fill="white">Tokenize</text>
    
    <!-- Command Structure -->
    <rect x="330" y="320" width="100" height="40" fill="#20c997" stroke="#17a085" stroke-width="2" rx="5"/>
    <text x="380" y="340" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" font-weight="bold" fill="white">s_cmd()</text>
    <text x="380" y="352" text-anchor="middle" font-family="Arial, sans-serif" font-size="9" fill="white">Token List</text>
    
    <!-- Token Type Detection -->
    <rect x="450" y="320" width="120" height="40" fill="#20c997" stroke="#17a085" stroke-width="2" rx="5"/>
    <text x="510" y="340" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" font-weight="bold" fill="white">ft_token_type()</text>
    <text x="510" y="352" text-anchor="middle" font-family="Arial, sans-serif" font-size="9" fill="white">WORD|PIPE|REDIR</text>
    
    <!-- Quote Processing -->
    <rect x="590" y="320" width="100" height="40" fill="#20c997" stroke="#17a085" stroke-width="2" rx="5"/>
    <text x="640" y="335" text-anchor="middle" font-family="Arial, sans-serif" font-size="9" font-weight="bold" fill="white">ft_quotes_type()</text>
    <text x="640" y="347" text-anchor="middle" font-family="Arial, sans-serif" font-size="9" fill="white">Quote Detection</text>
    <text x="640" y="357" text-anchor="middle" font-family="Arial, sans-serif" font-size="8" fill="white">SINGLE|DOUBLE</text>
    
    <!-- Expansion Phase -->
    <rect x="70" y="380" width="120" height="50" fill="#ffc107" stroke="#e0a800" stroke-width="2" rx="5"/>
    <text x="130" y="400" text-anchor="middle" font-family="Arial, sans-serif" font-size="11" font-weight="bold" fill="white">ft_expand()</text>
    <text x="130" y="415" text-anchor="middle" font-family="Arial, sans-serif" font-size="9" fill="white">Variable Expansion</text>
    <text x="130" y="425" text-anchor="middle" font-family="Arial, sans-serif" font-size="9" fill="white">Quote Removal</text>
    
    <!-- Variable Expansion -->
    <rect x="210" y="380" width="100" height="50" fill="#ffc107" stroke="#e0a800" stroke-width="2" rx="5"/>
    <text x="260" y="400" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" font-weight="bold" fill="white">exp_val()</text>
    <text x="260" y="415" text-anchor="middle" font-family="Arial, sans-serif" font-size="9" fill="white">$VAR → value</text>
    <text x="260" y="425" text-anchor="middle" font-family="Arial, sans-serif" font-size="9" fill="white">Environment</text>
    
    <!-- Quote Removal -->
    <rect x="330" y="380" width="100" height="50" fill="#ffc107" stroke="#e0a800" stroke-width="2" rx="5"/>
    <text x="380" y="395" text-anchor="middle" font-family="Arial, sans-serif" font-size="9" font-weight="bold" fill="white">ft_remove_</text>
    <text x="380" y="407" text-anchor="middle" font-family="Arial, sans-serif" font-size="9" font-weight="bold" fill="white">quotes()</text>
    <text x="380" y="420" text-anchor="middle" font-family="Arial, sans-serif" font-size="9" fill="white">"text" → text</text>
    <text x="380" y="430" text-anchor="middle" font-family="Arial, sans-serif" font-size="9" fill="white">'text' → text</text>
    
    <!-- Heredoc Processing -->
    <rect x="450" y="380" width="120" height="50" fill="#dc3545" stroke="#c82333" stroke-width="2" rx="5"/>
    <text x="510" y="400" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" font-weight="bold" fill="white">handle_heredoc()</text>
    <text x="510" y="415" text-anchor="middle" font-family="Arial, sans-serif" font-size="9" fill="white">Temp Files</text>
    <text x="510" y="425" text-anchor="middle" font-family="Arial, sans-serif" font-size="9" fill="white">File Descriptors</text>
    
    <!-- Heredoc Input -->
    <rect x="590" y="380" width="100" height="50" fill="#dc3545" stroke="#c82333" stroke-width="2" rx="5"/>
    <text x="640" y="395" text-anchor="middle" font-family="Arial, sans-serif" font-size="9" font-weight="bold" fill="white">ft_heredoc_</text>
    <text x="640" y="407" text-anchor="middle" font-family="Arial, sans-serif" font-size="9" font-weight="bold" fill="white">handle()</text>
    <text x="640" y="420" text-anchor="middle" font-family="Arial, sans-serif" font-size="9" fill="white">Interactive Input</text>
    <text x="640" y="430" text-anchor="middle" font-family="Arial, sans-serif" font-size="9" fill="white">Delimiter Check</text>
    
    <!-- Execution Preparation -->
    <rect x="70" y="450" width="150" height="40" fill="#6f42c1" stroke="#59359a" stroke-width="2" rx="5"/>
    <text x="145" y="470" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" font-weight="bold" fill="white">convert_token_to_exec()</text>
    <text x="145" y="482" text-anchor="middle" font-family="Arial, sans-serif" font-size="9" fill="white">Build Exec Structure</text>
  </g>

  <!-- PHASE 4: EXECUTION -->
  <g id="execution-phase">
    <rect x="800" y="60" width="750" height="440" fill="none" stroke="#e83e8c" stroke-width="3" rx="10"/>
    <text x="1175" y="80" text-anchor="middle" font-family="Arial, sans-serif" font-size="16" font-weight="bold" fill="#e83e8c">EXECUTION PHASE</text>
    
    <!-- Main Execution -->
    <rect x="820" y="100" width="100" height="40" fill="#e83e8c" stroke="#d91a72" stroke-width="2" rx="5"/>
    <text x="870" y="120" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" font-weight="bold" fill="white">execution()</text>
    <text x="870" y="132" text-anchor="middle" font-family="Arial, sans-serif" font-size="9" fill="white">Main Exec</text>
    
    <!-- Single vs Pipeline -->
    <rect x="940" y="100" width="120" height="40" fill="#e83e8c" stroke="#d91a72" stroke-width="2" rx="5"/>
    <text x="1000" y="115" text-anchor="middle" font-family="Arial, sans-serif" font-size="9" font-weight="bold" fill="white">ft_lstsize(exec)</text>
    <text x="1000" y="127" text-anchor="middle" font-family="Arial, sans-serif" font-size="9" fill="white">Single vs Pipeline</text>
    <text x="1000" y="137" text-anchor="middle" font-family="Arial, sans-serif" font-size="8" fill="white">Decision Point</text>
    
    <!-- Builtin Check -->
    <rect x="1080" y="100" width="100" height="40" fill="#17a2b8" stroke="#138496" stroke-width="2" rx="5"/>
    <text x="1130" y="120" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" font-weight="bold" fill="white">is_builtin()</text>
    <text x="1130" y="132" text-anchor="middle" font-family="Arial, sans-serif" font-size="9" fill="white">Built-in Check</text>
    
    <!-- Builtin Execution -->
    <rect x="820" y="160" width="150" height="60" fill="#17a2b8" stroke="#138496" stroke-width="2" rx="5"/>
    <text x="895" y="180" text-anchor="middle" font-family="Arial, sans-serif" font-size="11" font-weight="bold" fill="white">execute_builtin()</text>
    <text x="895" y="195" text-anchor="middle" font-family="Arial, sans-serif" font-size="9" fill="white">echo|cd|pwd|export</text>
    <text x="895" y="207" text-anchor="middle" font-family="Arial, sans-serif" font-size="9" fill="white">unset|env|exit</text>
    
    <!-- Process Creation -->
    <rect x="990" y="160" width="120" height="60" fill="#fd7e14" stroke="#e8590c" stroke-width="2" rx="5"/>
    <text x="1050" y="180" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" font-weight="bold" fill="white">execute_cmd()</text>
    <text x="1050" y="195" text-anchor="middle" font-family="Arial, sans-serif" font-size="9" fill="white">fork() → pipe()</text>
    <text x="1050" y="207" text-anchor="middle" font-family="Arial, sans-serif" font-size="9" fill="white">Process Creation</text>
    
    <!-- Path Resolution -->
    <rect x="1130" y="160" width="100" height="60" fill="#28a745" stroke="#1e7e34" stroke-width="2" rx="5"/>
    <text x="1180" y="180" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" font-weight="bold" fill="white">get_cmd_path()</text>
    <text x="1180" y="195" text-anchor="middle" font-family="Arial, sans-serif" font-size="9" fill="white">PATH Resolution</text>
    <text x="1180" y="207" text-anchor="middle" font-family="Arial, sans-serif" font-size="9" fill="white">Command Search</text>
    
    <!-- Child Process -->
    <rect x="820" y="240" width="120" height="60" fill="#6f42c1" stroke="#59359a" stroke-width="2" rx="5"/>
    <text x="880" y="265" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" font-weight="bold" fill="white">in_child()</text>
    <text x="880" y="280" text-anchor="middle" font-family="Arial, sans-serif" font-size="9" fill="white">Child Setup</text>
    <text x="880" y="292" text-anchor="middle" font-family="Arial, sans-serif" font-size="9" fill="white">Signal Handling</text>
    
    <!-- File Descriptor Management -->
    <rect x="960" y="240" width="120" height="60" fill="#6f42c1" stroke="#59359a" stroke-width="2" rx="5"/>
    <text x="1020" y="260" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" font-weight="bold" fill="white">redirect_fds()</text>
    <text x="1020" y="275" text-anchor="middle" font-family="Arial, sans-serif" font-size="9" fill="white">stdin/stdout</text>
    <text x="1020" y="287" text-anchor="middle" font-family="Arial, sans-serif" font-size="9" fill="white">Redirection</text>
    
    <!-- Execution Call -->
    <rect x="1100" y="240" width="100" height="60" fill="#dc3545" stroke="#c82333" stroke-width="2" rx="5"/>
    <text x="1150" y="265" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" font-weight="bold" fill="white">call_execve()</text>
    <text x="1150" y="280" text-anchor="middle" font-family="Arial, sans-serif" font-size="9" fill="white">execve() Call</text>
    <text x="1150" y="292" text-anchor="middle" font-family="Arial, sans-serif" font-size="9" fill="white">Program Launch</text>
    
    <!-- Parent Process -->
    <rect x="820" y="320" width="120" height="50" fill="#6c757d" stroke="#495057" stroke-width="2" rx="5"/>
    <text x="880" y="340" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" font-weight="bold" fill="white">parent_thing()</text>
    <text x="880" y="355" text-anchor="middle" font-family="Arial, sans-serif" font-size="9" fill="white">Parent Setup</text>
    <text x="880" y="365" text-anchor="middle" font-family="Arial, sans-serif" font-size="9" fill="white">Pipe Management</text>
    
    <!-- Wait & Status -->
    <rect x="960" y="320" width="120" height="50" fill="#6c757d" stroke="#495057" stroke-width="2" rx="5"/>
    <text x="1020" y="340" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" font-weight="bold" fill="white">check_exit_status()</text>
    <text x="1020" y="355" text-anchor="middle" font-family="Arial, sans-serif" font-size="9" fill="white">wait() + Status</text>
    <text x="1020" y="365" text-anchor="middle" font-family="Arial, sans-serif" font-size="9" fill="white">Signal Handling</text>
    
    <!-- Redirection Handling -->
    <rect x="1100" y="320" width="120" height="50" fill="#ffc107" stroke="#e0a800" stroke-width="2" rx="5"/>
    <text x="1160" y="340" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" font-weight="bold" fill="white">handle_redirects()</text>
    <text x="1160" y="355" text-anchor="middle" font-family="Arial, sans-serif" font-size="9" fill="white">&lt; &gt; &gt;&gt; &lt;&lt;</text>
    <text x="1160" y="365" text-anchor="middle" font-family="Arial, sans-serif" font-size="9" fill="white">File Operations</text>
    
    <!-- Error Handling -->
    <rect x="1240" y="160" width="100" height="60" fill="#dc3545" stroke="#c82333" stroke-width="2" rx="5"/>
    <text x="1290" y="180" text-anchor="middle" font-family="Arial, sans-serif" font-size="9" font-weight="bold" fill="white">handle_execve_</text>
    <text x="1290" y="192" text-anchor="middle" font-family="Arial, sans-serif" font-size="9" font-weight="bold" fill="white">error()</text>
    <text x="1290" y="205" text-anchor="middle" font-family="Arial, sans-serif" font-size="9" fill="white">Error Messages</text>
    <text x="1290" y="215" text-anchor="middle" font-family="Arial, sans-serif" font-size="9" fill="white">Exit Codes</text>
    
    <!-- Ambiguous Redirections -->
    <rect x="1240" y="240" width="100" height="50" fill="#dc3545" stroke="#c82333" stroke-width="2" rx="5"/>
    <text x="1290" y="260" text-anchor="middle" font-family="Arial, sans-serif" font-size="9" font-weight="bold" fill="white">ambiguous_red()</text>
    <text x="1290" y="275" text-anchor="middle" font-family="Arial, sans-serif" font-size="9" fill="white">Error Handling</text>
    <text x="1290" y="285" text-anchor="middle" font-family="Arial, sans-serif" font-size="9" fill="white">File Errors</text>
  </g>

  <!-- PHASE 5: UTILITIES & SUPPORT -->
  <g id="utilities-phase">
    <rect x="50" y="540" width="700" height="160" fill="none" stroke="#6c757d" stroke-width="3" rx="10"/>
    <text x="400" y="560" text-anchor="middle" font-family="Arial, sans-serif" font-size="16" font-weight="bold" fill="#6c757d">UTILITIES &amp; SUPPORT SYSTEMS</text>
    
    <!-- Memory Management -->
    <rect x="70" y="580" width="120" height="50" fill="#6c757d" stroke="#495057" stroke-width="2" rx="5"/>
    <text x="130" y="600" text-anchor="middle" font-family="Arial, sans-serif" font-size="11" font-weight="bold" fill="white">Memory System</text>
    <text x="130" y="615" text-anchor="middle" font-family="Arial, sans-serif" font-size="9" fill="white">ft_malloc()</text>
    <text x="130" y="625" text-anchor="middle" font-family="Arial, sans-serif" font-size="9" fill="white">ALLOC|CLEAR_DATA</text>
    
    <!-- String Utilities -->
    <rect x="210" y="580" width="100" height="50" fill="#6c757d" stroke="#495057" stroke-width="2" rx="5"/>
    <text x="260" y="600" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" font-weight="bold" fill="white">String Utils</text>
    <text x="260" y="615" text-anchor="middle" font-family="Arial, sans-serif" font-size="9" fill="white">ft_strlen|strjoin</text>
    <text x="260" y="625" text-anchor="middle" font-family="Arial, sans-serif" font-size="9" fill="white">ft_strcmp|strdup</text>
    
    <!-- Environment Utils -->
    <rect x="330" y="580" width="100" height="50" fill="#6c757d" stroke="#495057" stroke-width="2" rx="5"/>
    <text x="380" y="595" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" font-weight="bold" fill="white">Env Utils</text>
    <text x="380" y="610" text-anchor="middle" font-family="Arial, sans-serif" font-size="9" fill="white">find_env()</text>
    <text x="380" y="620" text-anchor="middle" font-family="Arial, sans-serif" font-size="9" fill="white">get_env_value()</text>
    <text x="380" y="630" text-anchor="middle" font-family="Arial, sans-serif" font-size="9" fill="white">convert_t_env()</text>
    
    <!-- Split Functions -->
    <rect x="450" y="580" width="100" height="50" fill="#6c757d" stroke="#495057" stroke-width="2" rx="5"/>
    <text x="500" y="595" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" font-weight="bold" fill="white">Split Functions</text>
    <text x="500" y="610" text-anchor="middle" font-family="Arial, sans-serif" font-size="9" fill="white">a_split()</text>
    <text x="500" y="620" text-anchor="middle" font-family="Arial, sans-serif" font-size="9" fill="white">ft_split_exec()</text>
    <text x="500" y="630" text-anchor="middle" font-family="Arial, sans-serif" font-size="9" fill="white">s_var()</text>
    
    <!-- List Utils -->
    <rect x="570" y="580" width="100" height="50" fill="#6c757d" stroke="#495057" stroke-width="2" rx="5"/>
    <text x="620" y="595" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" font-weight="bold" fill="white">List Utils</text>
    <text x="620" y="610" text-anchor="middle" font-family="Arial, sans-serif" font-size="9" fill="white">ft_lstadd_back()</text>
    <text x="620" y="620" text-anchor="middle" font-family="Arial, sans-serif" font-size="9" fill="white">ft_lstlast()</text>
    <text x="620" y="630" text-anchor="middle" font-family="Arial, sans-serif" font-size="9" fill="white">ft_lstsize()</text>
    
    <!-- Error & Status -->
    <rect x="70" y="640" width="120" height="50" fill="#dc3545" stroke="#c82333" stroke-width="2" rx="5"/>
    <text x="130" y="660" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" font-weight="bold" fill="white">Error &amp; Status</text>
    <text x="130" y="675" text-anchor="middle" font-family="Arial, sans-serif" font-size="9" fill="white">ft_syntax_error()</text>
    <text x="130" y="685" text-anchor="middle" font-family="Arial, sans-serif" font-size="9" fill="white">e_status()</text>
    
    <!-- Signal Utils -->
    <rect x="210" y="640" width="100" height="50" fill="#dc3545" stroke="#c82333" stroke-width="2" rx="5"/>
    <text x="260" y="660" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" font-weight="bold" fill="white">Signal Utils</text>
    <text x="260" y="675" text-anchor="middle" font-family="Arial, sans-serif" font-size="9" fill="white">handler()</text>
    <text x="260" y="685" text-anchor="middle" font-family="Arial, sans-serif" font-size="9" fill="white">heredoc_signal()</text>
    
    <!-- File Utils -->
    <rect x="330" y="640" width="100" height="50" fill="#28a745" stroke="#1e7e34" stroke-width="2" rx="5"/>
    <text x="380" y="660" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" font-weight="bold" fill="white">File Utils</text>
    <text x="380" y="675" text-anchor="middle" font-family="Arial, sans-serif" font-size="9" fill="white">ft_putstr_fd()</text>
    <text x="380" y="685" text-anchor="middle" font-family="Arial, sans-serif" font-size="9" fill="white">open|close|dup2</text>
    
    <!-- Validation Utils -->
    <rect x="450" y="640" width="100" height="50" fill="#ffc107" stroke="#e0a800" stroke-width="2" rx="5"/>
    <text x="500" y="660" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" font-weight="bold" fill="white">Validation</text>
    <text x="500" y="675" text-anchor="middle" font-family="Arial, sans-serif" font-size="9" fill="white">check_id()</text>
    <text x="500" y="685" text-anchor="middle" font-family="Arial, sans-serif" font-size="9" fill="white">is_valid_*</text>
  </g>

  <!-- PHASE 6: CLEANUP & EXIT -->
  <g id="cleanup-phase">
    <rect x="800" y="540" width="350" height="160" fill="none" stroke="#343a40" stroke-width="3" rx="10"/>
    <text x="975" y="560" text-anchor="middle" font-family="Arial, sans-serif" font-size="16" font-weight="bold" fill="#343a40">CLEANUP &amp; EXIT PHASE</text>
    
    <!-- Memory Cleanup -->
    <rect x="820" y="580" width="120" height="50" fill="#343a40" stroke="#212529" stroke-width="2" rx="5"/>
    <text x="880" y="600" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" font-weight="bold" fill="white">Memory Cleanup</text>
    <text x="880" y="615" text-anchor="middle" font-family="Arial, sans-serif" font-size="9" fill="white">ft_malloc(0, CLEAR_DATA)</text>
    <text x="880" y="625" text-anchor="middle" font-family="Arial, sans-serif" font-size="9" fill="white">Free All</text>
    
    <!-- History Cleanup -->
    <rect x="960" y="580" width="100" height="50" fill="#343a40" stroke="#212529" stroke-width="2" rx="5"/>
    <text x="1010" y="600" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" font-weight="bold" fill="white">History</text>
    <text x="1010" y="615" text-anchor="middle" font-family="Arial, sans-serif" font-size="9" fill="white">rl_clear_history()</text>
    <text x="1010" y="625" text-anchor="middle" font-family="Arial, sans-serif" font-size="9" fill="white">Readline Cleanup</text>
    
    <!-- File Descriptor Cleanup -->
    <rect x="820" y="640" width="120" height="50" fill="#343a40" stroke="#212529" stroke-width="2" rx="5"/>
    <text x="880" y="660" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" font-weight="bold" fill="white">FD Cleanup</text>
    <text x="880" y="675" text-anchor="middle" font-family="Arial, sans-serif" font-size="9" fill="white">close() all fds</text>
    <text x="880" y="685" text-anchor="middle" font-family="Arial, sans-serif" font-size="9" fill="white">unlink() temp files</text>
    
    <!-- Exit Status -->
    <rect x="960" y="640" width="100" height="50" fill="#343a40" stroke="#212529" stroke-width="2" rx="5"/>
    <text x="1010" y="660" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" font-weight="bold" fill="white">Exit</text>
    <text x="1010" y="675" text-anchor="middle" font-family="Arial, sans-serif" font-size="9" fill="white">e_status()</text>
    <text x="1010" y="685" text-anchor="middle" font-family="Arial, sans-serif" font-size="9" fill="white">exit()</text>
  </g>

  <!-- MAIN PROGRAM FLOW ARROWS -->
  <!-- Initialization Flow -->
  <line x1="170" y1="120" x2="190" y2="120" stroke="#007bff" stroke-width="3" marker-end="url(#arrowhead)"/>
  <line x1="290" y1="120" x2="310" y2="120" stroke="#007bff" stroke-width="3" marker-end="url(#arrowhead)"/>
  <line x1="350" y1="140" x2="130" y2="160" stroke="#28a745" stroke-width="2" marker-end="url(#dataarrow)"/>
  
  <!-- To Input Phase -->
  <line x1="400" y1="120" x2="470" y2="120" stroke="#007bff" stroke-width="3" marker-end="url(#arrowhead)"/>
  
  <!-- Input Phase Flow -->
  <line x1="560" y1="120" x2="580" y2="120" stroke="#fd7e14" stroke-width="2" marker-end="url(#arrowhead)"/>
  <line x1="660" y1="120" x2="680" y2="120" stroke="#fd7e14" stroke-width="2" marker-end="url(#arrowhead)"/>
  <line x1="515" y1="140" x2="515" y2="160" stroke="#fd7e14" stroke-width="2" marker-end="url(#arrowhead)"/>
  
  <!-- To Parsing Phase -->
  <line x1="600" y1="240" x2="400" y2="280" stroke="#fd7e14" stroke-width="3" marker-end="url(#arrowhead)"/>
  
  <!-- Parsing Phase Flow -->
  <line x1="190" y1="340" x2="210" y2="340" stroke="#20c997" stroke-width="2" marker-end="url(#arrowhead)"/>
  <line x1="310" y1="340" x2="330" y2="340" stroke="#20c997" stroke-width="2" marker-end="url(#arrowhead)"/>
  <line x1="430" y1="340" x2="450" y2="340" stroke="#20c997" stroke-width="2" marker-end="url(#arrowhead)"/>
  <line x1="570" y1="340" x2="590" y2="340" stroke="#20c997" stroke-width="2" marker-end="url(#arrowhead)"/>
  
  <!-- Expansion Flow -->
  <line x1="130" y1="360" x2="130" y2="380" stroke="#20c997" stroke-width="2" marker-end="url(#arrowhead)"/>
  <line x1="190" y1="405" x2="210" y2="405" stroke="#ffc107" stroke-width="2" marker-end="url(#arrowhead)"/>
  <line x1="310" y1="405" x2="330" y2="405" stroke="#ffc107" stroke-width="2" marker-end="url(#arrowhead)"/>
  <line x1="430" y1="405" x2="450" y2="405" stroke="#ffc107" stroke-width="2" marker-end="url(#arrowhead)"/>
  <line x1="570" y1="405" x2="590" y2="405" stroke="#ffc107" stroke-width="2" marker-end="url(#arrowhead)"/>
  
  <!-- To Execution Preparation -->
  <line x1="145" y1="430" x2="145" y2="450" stroke="#20c997" stroke-width="2" marker-end="url(#arrowhead)"/>
  
  <!-- To Execution Phase -->
  <line x1="220" y1="470" x2="820" y2="120" stroke="#6f42c1" stroke-width="3" marker-end="url(#arrowhead)"/>
  
  <!-- Execution Flow -->
  <line x1="920" y1="120" x2="940" y2="120" stroke="#e83e8c" stroke-width="2" marker-end="url(#arrowhead)"/>
  <line x1="1060" y1="120" x2="1080" y2="120" stroke="#e83e8c" stroke-width="2" marker-end="url(#arrowhead)"/>
  
  <!-- Builtin vs External -->
  <line x1="1000" y1="140" x2="895" y2="160" stroke="#17a2b8" stroke-width="2" marker-end="url(#arrowhead)"/>
  <line x1="1000" y1="140" x2="1050" y2="160" stroke="#fd7e14" stroke-width="2" marker-end="url(#arrowhead)"/>
  
  <!-- External Command Flow -->
  <line x1="1110" y1="180" x2="1130" y2="180" stroke="#fd7e14" stroke-width="2" marker-end="url(#arrowhead)"/>
  <line x1="1050" y1="220" x2="880" y2="240" stroke="#fd7e14" stroke-width="2" marker-end="url(#arrowhead)"/>
  <line x1="940" y1="270" x2="960" y2="270" stroke="#6f42c1" stroke-width="2" marker-end="url(#arrowhead)"/>
  <line x1="1080" y1="270" x2="1100" y2="270" stroke="#6f42c1" stroke-width="2" marker-end="url(#arrowhead)"/>
  
  <!-- Parent Process Flow -->
  <line x1="1050" y1="220" x2="880" y2="320" stroke="#fd7e14" stroke-width="2" marker-end="url(#arrowhead)"/>
  <line x1="940" y1="345" x2="960" y2="345" stroke="#6c757d" stroke-width="2" marker-end="url(#arrowhead)"/>
  
  <!-- Error Handling -->
  <line x1="1200" y1="270" x2="1240" y2="190" stroke="#dc3545" stroke-width="2" marker-end="url(#errorarrow)"/>
  <line x1="1220" y1="345" x2="1240" y2="265" stroke="#dc3545" stroke-width="2" marker-end="url(#errorarrow)"/>
  
  <!-- Utilities Support (dashed lines) -->
  <line x1="130" y1="430" x2="130" y2="580" stroke="#6c757d" stroke-width="2" stroke-dasharray="5,5" marker-end="url(#dataarrow)"/>
  <line x1="260" y1="360" x2="260" y2="580" stroke="#6c757d" stroke-width="2" stroke-dasharray="5,5" marker-end="url(#dataarrow)"/>
  <line x1="380" y1="430" x2="380" y2="580" stroke="#6c757d" stroke-width="2" stroke-dasharray="5,5" marker-end="url(#dataarrow)"/>
  <line x1="870" y1="340" x2="880" y2="580" stroke="#6c757d" stroke-width="2" stroke-dasharray="5,5" marker-end="url(#dataarrow)"/>
  
  <!-- To Cleanup -->
  <line x1="1020" y1="370" x2="975" y2="540" stroke="#343a40" stroke-width="3" marker-end="url(#arrowhead)"/>
  
  <!-- Cleanup Flow -->
  <line x1="940" y1="605" x2="960" y2="605" stroke="#343a40" stroke-width="2" marker-end="url(#arrowhead)"/>
  <line x1="880" y1="630" x2="880" y2="640" stroke="#343a40" stroke-width="2" marker-end="url(#arrowhead)"/>
  <line x1="940" y1="665" x2="960" y2="665" stroke="#343a40" stroke-width="2" marker-end="url(#arrowhead)"/>

  <!-- Loop Back Arrow (Main Loop) -->
  <path d="M 1010 690 Q 1400 720 1400 400 Q 1400 50 600 50 Q 200 50 200 280" 
        stroke="#007bff" stroke-width="3" fill="none" stroke-dasharray="10,5" marker-end="url(#arrowhead)"/>
  <text x="1300" y="45" text-anchor="middle" font-family="Arial, sans-serif" font-size="12" font-weight="bold" fill="#007bff">Main Loop (while(1))</text>

  <!-- Legend -->
  <g id="legend" transform="translate(1200, 540)">
    <rect x="0" y="0" width="350" height="160" fill="none" stroke="#6c757d" stroke-width="2" rx="5"/>
    <text x="175" y="20" text-anchor="middle" font-family="Arial, sans-serif" font-size="14" font-weight="bold" fill="#212529">Legend</text>
    
    <!-- Function Call -->
    <line x1="20" y1="40" x2="50" y2="40" stroke="#007bff" stroke-width="3" marker-end="url(#arrowhead)"/>
    <text x="60" y="45" font-family="Arial, sans-serif" font-size="10" fill="#212529">Function Call</text>
    
    <!-- Data Flow -->
    <line x1="20" y1="60" x2="50" y2="60" stroke="#28a745" stroke-width="2" marker-end="url(#dataarrow)"/>
    <text x="60" y="65" font-family="Arial, sans-serif" font-size="10" fill="#212529">Data Flow</text>
    
    <!-- Error Path -->
    <line x1="20" y1="80" x2="50" y2="80" stroke="#dc3545" stroke-width="2" marker-end="url(#errorarrow)"/>
    <text x="60" y="85" font-family="Arial, sans-serif" font-size="10" fill="#212529">Error Path</text>
    
    <!-- Support/Utility -->
    <line x1="20" y1="100" x2="50" y2="100" stroke="#6c757d" stroke-width="2" stroke-dasharray="5,5" marker-end="url(#dataarrow)"/>
    <text x="60" y="105" font-family="Arial, sans-serif" font-size="10" fill="#212529">Support/Utility</text>
    
    <!-- Loop -->
    <line x1="20" y1="120" x2="50" y2="120" stroke="#007bff" stroke-width="2" stroke-dasharray="10,5" marker-end="url(#arrowhead)"/>
    <text x="60" y="125" font-family="Arial, sans-serif" font-size="10" fill="#212529">Main Loop</text>
    
    <!-- Phase Colors -->
    <rect x="180" y="35" width="15" height="10" fill="#007bff" rx="2"/>
    <text x="200" y="43" font-family="Arial, sans-serif" font-size="9" fill="#212529">Initialization</text>
    
    <rect x="180" y="50" width="15" height="10" fill="#fd7e14" rx="2"/>
    <text x="200" y="58" font-family="Arial, sans-serif" font-size="9" fill="#212529">Input</text>
    
    <rect x="180" y="65" width="15" height="10" fill="#20c997" rx="2"/>
    <text x="200" y="73" font-family="Arial, sans-serif" font-size="9" fill="#212529">Parsing</text>
    
    <rect x="180" y="80" width="15" height="10" fill="#e83e8c" rx="2"/>
    <text x="200" y="88" font-family="Arial, sans-serif" font-size="9" fill="#212529">Execution</text>
    
    <rect x="180" y="95" width="15" height="10" fill="#6c757d" rx="2"/>
    <text x="200" y="103" font-family="Arial, sans-serif" font-size="9" fill="#212529">Utilities</text>
    
    <rect x="180" y="110" width="15" height="10" fill="#343a40" rx="2"/>
    <text x="200" y="118" font-family="Arial, sans-serif" font-size="9" fill="#212529">Cleanup</text>
  </g>

  <!-- Data Structures Overview -->
  <g id="data-structures" transform="translate(50, 750)">
    <rect x="0" y="0" width="700" height="120" fill="none" stroke="#17a2b8" stroke-width="2" rx="5"/>
    <text x="350" y="20" text-anchor="middle" font-family="Arial, sans-serif" font-size="14" font-weight="bold" fill="#17a2b8">Key Data Structures</text>
    
    <!-- t_shell -->
    <rect x="20" y="30" width="100" height="70" fill="#17a2b8" stroke="#138496" stroke-width="1" rx="3"/>
    <text x="70" y="45" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" font-weight="bold" fill="white">t_shell</text>
    <text x="70" y="58" text-anchor="middle" font-family="Arial, sans-serif" font-size="8" fill="white">input</text>
    <text x="70" y="68" text-anchor="middle" font-family="Arial, sans-serif" font-size="8" fill="white">lst</text>
    <text x="70" y="78" text-anchor="middle" font-family="Arial, sans-serif" font-size="8" fill="white">exec</text>
    <text x="70" y="88" text-anchor="middle" font-family="Arial, sans-serif" font-size="8" fill="white">envp</text>
    
    <!-- t_token -->
    <rect x="140" y="30" width="100" height="70" fill="#20c997" stroke="#17a085" stroke-width="1" rx="3"/>
    <text x="190" y="45" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" font-weight="bold" fill="white">t_token</text>
    <text x="190" y="58" text-anchor="middle" font-family="Arial, sans-serif" font-size="8" fill="white">type</text>
    <text x="190" y="68" text-anchor="middle" font-family="Arial, sans-serif" font-size="8" fill="white">value</text>
    <text x="190" y="78" text-anchor="middle" font-family="Arial, sans-serif" font-size="8" fill="white">fd_reder</text>
    <text x="190" y="88" text-anchor="middle" font-family="Arial, sans-serif" font-size="8" fill="white">next</text>
    
    <!-- t_exec -->
    <rect x="260" y="30" width="100" height="70" fill="#e83e8c" stroke="#d91a72" stroke-width="1" rx="3"/>
    <text x="310" y="45" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" font-weight="bold" fill="white">t_exec</text>
    <text x="310" y="58" text-anchor="middle" font-family="Arial, sans-serif" font-size="8" fill="white">cmd</text>
    <text x="310" y="68" text-anchor="middle" font-family="Arial, sans-serif" font-size="8" fill="white">cmd_args</text>
    <text x="310" y="78" text-anchor="middle" font-family="Arial, sans-serif" font-size="8" fill="white">fd_in/out</text>
    <text x="310" y="88" text-anchor="middle" font-family="Arial, sans-serif" font-size="8" fill="white">next</text>
    
    <!-- t_env -->
    <rect x="380" y="30" width="100" height="70" fill="#28a745" stroke="#1e7e34" stroke-width="1" rx="3"/>
    <text x="430" y="45" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" font-weight="bold" fill="white">t_env</text>
    <text x="430" y="58" text-anchor="middle" font-family="Arial, sans-serif" font-size="8" fill="white">key</text>
    <text x="430" y="68" text-anchor="middle" font-family="Arial, sans-serif" font-size="8" fill="white">value</text>
    <text x="430" y="78" text-anchor="middle" font-family="Arial, sans-serif" font-size="8" fill="white">next</text>
    
    <!-- t_expand_ctx -->
    <rect x="500" y="30" width="100" height="70" fill="#ffc107" stroke="#e0a800" stroke-width="1" rx="3"/>
    <text x="550" y="40" text-anchor="middle" font-family="Arial, sans-serif" font-size="9" font-weight="bold" fill="white">t_expand_ctx</text>
    <text x="550" y="53" text-anchor="middle" font-family="Arial, sans-serif" font-size="8" fill="white">expand_state</text>
    <text x="550" y="63" text-anchor="middle" font-family="Arial, sans-serif" font-size="8" fill="white">envp</text>
    <text x="550" y="73" text-anchor="middle" font-family="Arial, sans-serif" font-size="8" fill="white">new_value</text>
    <text x="550" y="83" text-anchor="middle" font-family="Arial, sans-serif" font-size="8" fill="white">source_string</text>
    
    <!-- t_heredoc_ctx -->
    <rect x="620" y="30" width="70" height="70" fill="#dc3545" stroke="#c82333" stroke-width="1" rx="3"/>
    <text x="655" y="40" text-anchor="middle" font-family="Arial, sans-serif" font-size="9" font-weight="bold" fill="white">t_heredoc_</text>
    <text x="655" y="50" text-anchor="middle" font-family="Arial, sans-serif" font-size="9" font-weight="bold" fill="white">ctx</text>
    <text x="655" y="63" text-anchor="middle" font-family="Arial, sans-serif" font-size="8" fill="white">tmp_file</text>
    <text x="655" y="73" text-anchor="middle" font-family="Arial, sans-serif" font-size="8" fill="white">fd_in</text>
    <text x="655" y="83" text-anchor="middle" font-family="Arial, sans-serif" font-size="8" fill="white">fd_out</text>
    <text x="655" y="93" text-anchor="middle" font-family="Arial, sans-serif" font-size="8" fill="white">status</text>
  </g>

  <!-- File Organization -->
  <g id="file-organization" transform="translate(800, 750)">
    <rect x="0" y="0" width="350" height="120" fill="none" stroke="#6f42c1" stroke-width="2" rx="5"/>
    <text x="175" y="20" text-anchor="middle" font-family="Arial, sans-serif" font-size="14" font-weight="bold" fill="#6f42c1">File Organization</text>
    
    <text x="20" y="40" font-family="Arial, sans-serif" font-size="10" font-weight="bold" fill="#6f42c1">Core:</text>
    <text x="20" y="52" font-family="Arial, sans-serif" font-size="9" fill="#212529">minishell.c, minishell.h, memory.c</text>
    
    <text x="20" y="70" font-family="Arial, sans-serif" font-size="10" font-weight="bold" fill="#6f42c1">Parsing:</text>
    <text x="20" y="82" font-family="Arial, sans-serif" font-size="9" fill="#212529">ft_expend.c, ft_split_command.c, ft_operators_redirection.c</text>
    
    <text x="20" y="100" font-family="Arial, sans-serif" font-size="10" font-weight="bold" fill="#6f42c1">Execution:</text>
    <text x="20" y="112" font-family="Arial, sans-serif" font-size="9" fill="#212529">main_exec.c, child_exec.c, ft_is_builtins.c, parse_exec.c</text>
  </g>

</svg>